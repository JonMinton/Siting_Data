###################################################################################
# FIRST STAGE 
###################################################################################
 # deltas all 0 to start with 
 # mu bounds set to 0 to 0.50
 
 # tolerance for delta 10^-2

 #creating the input object:

> In <- list(
+   data = list(
+     stayerprop= 0.4174,
+     counts = list(
+       oldcounts=countsold,
+       newcounts=countsnew      
+       )
+   ),
+   movingcostmatrix = movingcostmatrix,
+   utils = list(
+     deltas = rep(0, length(countsold) + 1) # Added one for outside region
+   ),
+   params = list(
+     tol_delta = 10^-2,
+     tol_mu = 10^-1,
+     mu_upper = 0.50,
+     mu_lower = 0,
+     maxit_outer = 1000,
+     maxit_inner = 100000,
+     use_logmu=F
+     ),
+   dbg = list(
+     dbgflag= T,
+     verboseflag=T
+ 
+   )
+ )
> 
> rm(movingcostmatrix)

# Load the C++ function with the input object
> x <- new(Contraction, In)
# Outputs from c++:

use_logmu is 0 i.e. False
Lengths of vectors oldcounts and newcounts are 1921 and 1921 respectively. Is this correct?
Constructor completed

# Back in R : Run (perform bisection and contraction mapping) C++ method:
> x$run()

#outputs displayed from C++: 

TRC
TP
totpop_t1: 2.94141e+06    totpop_t2: 3.21684e+06	dpop: 275429
Called from: eval(substitute(expr), envir, enclos)
Browse[1]> 
The total lengths of oldcounts and newcounts are 1922 and 1922
They should be 1922 in the current example. Are they?
Called from: eval(substitute(expr), envir, enclos)
Browse[1]> 
mu_diff: 9999.99	tol_mu: 0.1	stayp: 0.4174
Called from: eval(substitute(expr), envir, enclos)
Browse[1]> 

TO 1
Outer: 1	mu: 0.25 # outer loop, first iteration. Trying mu=0.25
TOT 
# In the lines below : 
   + : number of xfs that are increased
   - : number of xfs that are decreased
   rms : root mean squared change in xfs as a result of contraction mapping
   max : maximum change in any xf value (the condition of interest)

 Contraction mapping changes:	+ 1489	- 433	rms: 0.145231	max: 0.693147
 Contraction mapping changes:	+ 1489	- 433	rms: 0.144617	max: 0.692238
 Contraction mapping changes:	+ 912	- 1010	rms: 0.066544	max: 0.472015
 Contraction mapping changes:	+ 681	- 1241	rms: 0.0456376	max: 0.472015
 Contraction mapping changes:	+ 1490	- 432	rms: 0.0420466	max: 0.472015
 Contraction mapping changes:	+ 1491	- 431	rms: 0.0396074	max: 0.35422
 Contraction mapping changes:	+ 1491	- 431	rms: 0.0391025	max: 0.35422
 Contraction mapping changes:	+ 1492	- 430	rms: 0.0380104	max: 0.268264
 Contraction mapping changes:	+ 1492	- 430	rms: 0.037926	max: 0.268259
 Contraction mapping changes:	+ 1493	- 429	rms: 0.0373799	max: 0.227513
 Contraction mapping changes:	+ 1494	- 428	rms: 0.0368833	max: 0.216429
 Contraction mapping changes:	+ 1497	- 425	rms: 0.0353733	max: 0.175961
 Contraction mapping changes:	+ 1499	- 423	rms: 0.0352728	max: 0.175938
 Contraction mapping changes:	+ 1502	- 420	rms: 0.0344865	max: 0.16342
 Contraction mapping changes:	+ 1506	- 416	rms: 0.0332813	max: 0.150219
 Contraction mapping changes:	+ 1514	- 408	rms: 0.0317139	max: 0.139975
 Contraction mapping changes:	+ 1523	- 399	rms: 0.0299267	max: 0.130502
 Contraction mapping changes:	+ 1537	- 385	rms: 0.0273366	max: 0.122162
 Contraction mapping changes:	+ 1547	- 375	rms: 0.0257609	max: 0.114524
 Contraction mapping changes:	+ 1555	- 367	rms: 0.0245241	max: 0.10774
 Contraction mapping changes:	+ 1565	- 357	rms: 0.0233345	max: 0.102073
 Contraction mapping changes:	+ 1572	- 350	rms: 0.0222421	max: 0.0968063
 Contraction mapping changes:	+ 1577	- 345	rms: 0.0217968	max: 0.0923186
 Contraction mapping changes:	+ 1582	- 340	rms: 0.021046	max: 0.0879796
 Contraction mapping changes:	+ 1589	- 333	rms: 0.0199949	max: 0.0839975
 Contraction mapping changes:	+ 1602	- 320	rms: 0.0189229	max: 0.0804089
 Contraction mapping changes:	+ 1608	- 314	rms: 0.0182214	max: 0.0770252
 Contraction mapping changes:	+ 1617	- 305	rms: 0.0170236	max: 0.0740231
 Contraction mapping changes:	+ 1628	- 294	rms: 0.0161487	max: 0.0711796
 Contraction mapping changes:	+ 1632	- 290	rms: 0.0156303	max: 0.0685502
 Contraction mapping changes:	+ 1643	- 279	rms: 0.0147259	max: 0.0661138
 Contraction mapping changes:	+ 1649	- 273	rms: 0.013767	max: 0.0638287
 Contraction mapping changes:	+ 1658	- 264	rms: 0.0132531	max: 0.0617129
 Contraction mapping changes:	+ 1664	- 258	rms: 0.0126812	max: 0.059552
 Contraction mapping changes:	+ 1671	- 251	rms: 0.0121823	max: 0.0578584
 Contraction mapping changes:	+ 1676	- 246	rms: 0.0116595	max: 0.0560836
 Contraction mapping changes:	+ 1685	- 237	rms: 0.0110224	max: 0.0540423
 Contraction mapping changes:	+ 1690	- 232	rms: 0.0106645	max: 0.0528976
 Contraction mapping changes:	+ 1694	- 228	rms: 0.0103395	max: 0.0514222
 Contraction mapping changes:	+ 1698	- 224	rms: 0.0100642	max: 0.0500406
 Contraction mapping changes:	+ 1703	- 219	rms: 0.00966533	max: 0.0486165
 Contraction mapping changes:	+ 1707	- 215	rms: 0.0095267	max: 0.0474403
 Contraction mapping changes:	+ 1709	- 213	rms: 0.00920132	max: 0.0462033
 Contraction mapping changes:	+ 1715	- 207	rms: 0.00887285	max: 0.0449623
 Contraction mapping changes:	+ 1719	- 203	rms: 0.00833815	max: 0.0436994
 Contraction mapping changes:	+ 1726	- 196	rms: 0.00828949	max: 0.0430263
 Contraction mapping changes:	+ 1726	- 196	rms: 0.00805848	max: 0.0420351
 Contraction mapping changes:	+ 1731	- 191	rms: 0.00780803	max: 0.0410754
 Contraction mapping changes:	+ 1734	- 188	rms: 0.00749728	max: 0.040189
 Contraction mapping changes:	+ 1738	- 184	rms: 0.00711368	max: 0.0387511
 Contraction mapping changes:	+ 1744	- 178	rms: 0.00693652	max: 0.0385164
 Contraction mapping changes:	+ 1747	- 175	rms: 0.00689132	max: 0.0373416
 Contraction mapping changes:	+ 1747	- 175	rms: 0.00675938	max: 0.0368747
 Contraction mapping changes:	+ 1750	- 172	rms: 0.00672594	max: 0.0362124
 Contraction mapping changes:	+ 1750	- 172	rms: 0.00657592	max: 0.0355103
 Contraction mapping changes:	+ 1753	- 169	rms: 0.00642559	max: 0.0348569
 Contraction mapping changes:	+ 1755	- 167	rms: 0.00617893	max: 0.0341923
 Contraction mapping changes:	+ 1758	- 164	rms: 0.00583522	max: 0.0335793
 Contraction mapping changes:	+ 1763	- 159	rms: 0.00548865	max: 0.0329594
 Contraction mapping changes:	+ 1770	- 152	rms: 0.0051696	max: 0.0323862
 Contraction mapping changes:	+ 1777	- 145	rms: 0.00501906	max: 0.0318133
 Contraction mapping changes:	+ 1779	- 143	rms: 0.00492131	max: 0.0312056
 Contraction mapping changes:	+ 1781	- 141	rms: 0.00486752	max: 0.0307614
 Contraction mapping changes:	+ 1782	- 140	rms: 0.00475477	max: 0.0300107
 Contraction mapping changes:	+ 1782	- 140	rms: 0.00460903	max: 0.0297394
 Contraction mapping changes:	+ 1786	- 136	rms: 0.0045667	max: 0.0292788
 Contraction mapping changes:	+ 1787	- 135	rms: 0.00447961	max: 0.0288384
 Contraction mapping changes:	+ 1788	- 134	rms: 0.00433745	max: 0.0283731
 Contraction mapping changes:	+ 1791	- 131	rms: 0.00420598	max: 0.0279556
 Contraction mapping changes:	+ 1793	- 129	rms: 0.0041374	max: 0.0275353
 Contraction mapping changes:	+ 1795	- 127	rms: 0.00405611	max: 0.0270617
 Contraction mapping changes:	+ 1796	- 126	rms: 0.00398047	max: 0.026738
 Contraction mapping changes:	+ 1797	- 125	rms: 0.00388897	max: 0.0263361
 Contraction mapping changes:	+ 1799	- 123	rms: 0.00376466	max: 0.0259793
 Contraction mapping changes:	+ 1801	- 121	rms: 0.00368903	max: 0.0254922
 Contraction mapping changes:	+ 1803	- 119	rms: 0.00359867	max: 0.0252637
 Contraction mapping changes:	+ 1804	- 118	rms: 0.00352382	max: 0.0247487
 Contraction mapping changes:	+ 1807	- 115	rms: 0.00348918	max: 0.0245856
 Contraction mapping changes:	+ 1807	- 115	rms: 0.00346172	max: 0.0242493
 Contraction mapping changes:	+ 1808	- 114	rms: 0.0033992	max: 0.0239374
 Contraction mapping changes:	+ 1808	- 114	rms: 0.00332999	max: 0.0234891
 Contraction mapping changes:	+ 1810	- 112	rms: 0.0032344	max: 0.0233251
 Contraction mapping changes:	+ 1811	- 111	rms: 0.00317536	max: 0.0227688
 Contraction mapping changes:	+ 1814	- 108	rms: 0.00312866	max: 0.0214845
 Contraction mapping changes:	+ 1814	- 108	rms: 0.00308991	max: 0.0214845
 Contraction mapping changes:	+ 1815	- 107	rms: 0.00308655	max: 0.0214844
 Contraction mapping changes:	+ 1816	- 106	rms: 0.0030864	max: 0.0214837
 Contraction mapping changes:	+ 1816	- 106	rms: 0.00308631	max: 0.0214765
 Contraction mapping changes:	+ 1816	- 106	rms: 0.00308603	max: 0.0214119
 Contraction mapping changes:	+ 1816	- 106	rms: 0.00308387	max: 0.0208417
 Contraction mapping changes:	+ 1816	- 106	rms: 0.00307015	max: 0.0207944
 Contraction mapping changes:	+ 1816	- 106	rms: 0.00304685	max: 0.0206928
 Contraction mapping changes:	+ 1816	- 106	rms: 0.00303951	max: 0.0204567
 Contraction mapping changes:	+ 1817	- 105	rms: 0.003019	max: 0.0202026
 Contraction mapping changes:	+ 1817	- 105	rms: 0.00297383	max: 0.0200028
 Contraction mapping changes:	+ 1817	- 105	rms: 0.00291079	max: 0.0197678
 Contraction mapping changes:	+ 1818	- 104	rms: 0.00282022	max: 0.0195584
 Contraction mapping changes:	+ 1820	- 102	rms: 0.00275053	max: 0.0193491
 Contraction mapping changes:	+ 1822	- 100	rms: 0.0026768	max: 0.019162
 Contraction mapping changes:	+ 1824	- 98	rms: 0.00261254	max: 0.0189685
 Contraction mapping changes:	+ 1826	- 96	rms: 0.00256009	max: 0.0187684
 Contraction mapping changes:	+ 1828	- 94	rms: 0.00248691	max: 0.0184834
 Contraction mapping changes:	+ 1829	- 93	rms: 0.00241954	max: 0.0183954
 Contraction mapping changes:	+ 1830	- 92	rms: 0.00237595	max: 0.0181974
 Contraction mapping changes:	+ 1832	- 90	rms: 0.00235095	max: 0.0176985
 Contraction mapping changes:	+ 1834	- 88	rms: 0.00231547	max: 0.0176928
 Contraction mapping changes:	+ 1834	- 88	rms: 0.00229106	max: 0.0176583
 Contraction mapping changes:	+ 1835	- 87	rms: 0.00228515	max: 0.0175135
 Contraction mapping changes:	+ 1836	- 86	rms: 0.00227496	max: 0.0173205
 Contraction mapping changes:	+ 1836	- 86	rms: 0.00223595	max: 0.0167078
 Contraction mapping changes:	+ 1836	- 86	rms: 0.0021715	max: 0.016707
 Contraction mapping changes:	+ 1836	- 86	rms: 0.00213996	max: 0.0167023
 Contraction mapping changes:	+ 1838	- 84	rms: 0.00213528	max: 0.0166767
 Contraction mapping changes:	+ 1840	- 82	rms: 0.00213424	max: 0.0165371
 Contraction mapping changes:	+ 1840	- 82	rms: 0.00213062	max: 0.0163914
 Contraction mapping changes:	+ 1840	- 82	rms: 0.00211672	max: 0.0161804
 Contraction mapping changes:	+ 1840	- 82	rms: 0.00209008	max: 0.0161206
 Contraction mapping changes:	+ 1840	- 82	rms: 0.00206813	max: 0.0159365
 Contraction mapping changes:	+ 1840	- 82	rms: 0.00205631	max: 0.0158329
 Contraction mapping changes:	+ 1841	- 81	rms: 0.00203713	max: 0.0157042
 Contraction mapping changes:	+ 1842	- 80	rms: 0.00200822	max: 0.015526
 Contraction mapping changes:	+ 1842	- 80	rms: 0.00195523	max: 0.0154116
 Contraction mapping changes:	+ 1843	- 79	rms: 0.00187929	max: 0.0153089
 Contraction mapping changes:	+ 1843	- 79	rms: 0.00182516	max: 0.0150087
 Contraction mapping changes:	+ 1844	- 78	rms: 0.00179903	max: 0.0149915
 Contraction mapping changes:	+ 1847	- 75	rms: 0.00176821	max: 0.0149329
 Contraction mapping changes:	+ 1849	- 73	rms: 0.00174787	max: 0.0146691
 Contraction mapping changes:	+ 1849	- 73	rms: 0.00173992	max: 0.0143764
 Contraction mapping changes:	+ 1851	- 71	rms: 0.00172705	max: 0.0143746
 Contraction mapping changes:	+ 1851	- 71	rms: 0.00171446	max: 0.0143671
 Contraction mapping changes:	+ 1851	- 71	rms: 0.00171115	max: 0.0143345
 Contraction mapping changes:	+ 1851	- 71	rms: 0.00171011	max: 0.0141957
 Contraction mapping changes:	+ 1852	- 70	rms: 0.00170734	max: 0.0140599
 Contraction mapping changes:	+ 1852	- 70	rms: 0.00169883	max: 0.0140135
 Contraction mapping changes:	+ 1852	- 70	rms: 0.001684	max: 0.0138226
 Contraction mapping changes:	+ 1852	- 70	rms: 0.00167298	max: 0.0137882
 Contraction mapping changes:	+ 1852	- 70	rms: 0.00166124	max: 0.0136899
 Contraction mapping changes:	+ 1853	- 69	rms: 0.00164418	max: 0.0135878
 Contraction mapping changes:	+ 1853	- 69	rms: 0.00162548	max: 0.0132481
 Contraction mapping changes:	+ 1853	- 69	rms: 0.00159544	max: 0.0132332
 Contraction mapping changes:	+ 1854	- 68	rms: 0.00156455	max: 0.0132251
 Contraction mapping changes:	+ 1854	- 68	rms: 0.00154906	max: 0.0131942
 Contraction mapping changes:	+ 1854	- 68	rms: 0.00154457	max: 0.0131075
 Contraction mapping changes:	+ 1856	- 66	rms: 0.00154072	max: 0.0130139
 Contraction mapping changes:	+ 1857	- 65	rms: 0.00153008	max: 0.0129216
 Contraction mapping changes:	+ 1857	- 65	rms: 0.00150571	max: 0.012822
 Contraction mapping changes:	+ 1857	- 65	rms: 0.00147321	max: 0.0127156
 Contraction mapping changes:	+ 1857	- 65	rms: 0.00144386	max: 0.01265
 Contraction mapping changes:	+ 1857	- 65	rms: 0.00141856	max: 0.012562
 Contraction mapping changes:	+ 1858	- 64	rms: 0.00139583	max: 0.0124377
 Contraction mapping changes:	+ 1859	- 63	rms: 0.00137407	max: 0.0122559
 Contraction mapping changes:	+ 1860	- 62	rms: 0.00135374	max: 0.0122479
 Contraction mapping changes:	+ 1861	- 61	rms: 0.00133672	max: 0.0122203
 Contraction mapping changes:	+ 1862	- 60	rms: 0.00132615	max: 0.0121255
 Contraction mapping changes:	+ 1862	- 60	rms: 0.00132169	max: 0.011931
 Contraction mapping changes:	+ 1863	- 59	rms: 0.0013165	max: 0.0119236
 Contraction mapping changes:	+ 1864	- 58	rms: 0.00130644	max: 0.0118989
 Contraction mapping changes:	+ 1864	- 58	rms: 0.00129552	max: 0.0118166
 Contraction mapping changes:	+ 1864	- 58	rms: 0.00128962	max: 0.0117548
 Contraction mapping changes:	+ 1864	- 58	rms: 0.00128418	max: 0.0116089
 Contraction mapping changes:	+ 1864	- 58	rms: 0.00127338	max: 0.0113397
 Contraction mapping changes:	+ 1865	- 57	rms: 0.00125743	max: 0.011339
 Contraction mapping changes:	+ 1865	- 57	rms: 0.00124237	max: 0.0113367
 Contraction mapping changes:	+ 1865	- 57	rms: 0.00123303	max: 0.0113295
 Contraction mapping changes:	+ 1865	- 57	rms: 0.00122993	max: 0.011307
 Contraction mapping changes:	+ 1866	- 56	rms: 0.00122883	max: 0.0112364
 Contraction mapping changes:	+ 1867	- 55	rms: 0.00122728	max: 0.0111776
 Contraction mapping changes:	+ 1867	- 55	rms: 0.00122348	max: 0.0110555
 Contraction mapping changes:	+ 1867	- 55	rms: 0.00121477	max: 0.0109497
 Contraction mapping changes:	+ 1867	- 55	rms: 0.00120054	max: 0.0109393
 Contraction mapping changes:	+ 1867	- 55	rms: 0.00118549	max: 0.0109081
 Contraction mapping changes:	+ 1867	- 55	rms: 0.00117423	max: 0.0108442
 Contraction mapping changes:	+ 1867	- 55	rms: 0.00116772	max: 0.0107128
 Contraction mapping changes:	+ 1868	- 54	rms: 0.00116079	max: 0.0106806
 Contraction mapping changes:	+ 1868	- 54	rms: 0.00114782	max: 0.010652
 Contraction mapping changes:	+ 1869	- 53	rms: 0.00112885	max: 0.0105919
 Contraction mapping changes:	+ 1869	- 53	rms: 0.00111166	max: 0.0105246
 Contraction mapping changes:	+ 1869	- 53	rms: 0.00109758	max: 0.0104596
 Contraction mapping changes:	+ 1869	- 53	rms: 0.0010775	max: 0.0102748
 Contraction mapping changes:	+ 1870	- 52	rms: 0.00104826	max: 0.0101518
 Contraction mapping changes:	+ 1871	- 51	rms: 0.00102095	max: 0.0101507
 Contraction mapping changes:	+ 1871	- 51	rms: 0.00100302	max: 0.0101478
 Contraction mapping changes:	+ 1871	- 51	rms: 0.000993286	max: 0.0101396
 Contraction mapping changes:	+ 1871	- 51	rms: 0.000989627	max: 0.0101167
 Contraction mapping changes:	+ 1874	- 48	rms: 0.000988297	max: 0.0100534
# contraction mapping loop now exited. Reporting a summary:
change_max is 0.00999928 after 18444 calls to inner
# Outer loop: method of bisection - mu changed to 0.125
Outer: 2	mu: 0.125
# Contraction mapping called again:
TOT
 Contraction mapping changes:	+ 414	- 1508	rms: 28.5232	max: 65.1116
 Contraction mapping changes:	+ 420	- 1502	rms: 0.164281	max: 0.314008
 Contraction mapping changes:	+ 423	- 1499	rms: 0.00921208	max: 0.028723
change_max is 0.00999987 after 253 calls to inner
# convergence now much quicker

#third outer
Outer: 3	mu: 0.0625
TOT
 Contraction mapping changes:	+ 433	- 1489	rms: 13.9654	max: 32.0673
 Contraction mapping changes:	+ 439	- 1483	rms: 0.0304859	max: 0.0721495
change_max is 0.00989584 after 185 calls to inner
Outer: 4	mu: 0.03125
TOT
 Contraction mapping changes:	+ 440	- 1482	rms: 6.37309	max: 15.5448
 Contraction mapping changes:	+ 441	- 1481	rms: 0.00488997	max: 0.018845
change_max is 0.0099313 after 149 calls to inner
Outer: 5	mu: 0.015625
TOT
 Contraction mapping changes:	+ 440	- 1482	rms: 2.48981	max: 7.28407
 Contraction mapping changes:	+ 440	- 1482	rms: 0.0029125	max: 0.0135234
change_max is 0.00995584 after 127 calls to inner
Outer: 6	mu: 0.0078125
TOT
 Contraction mapping changes:	+ 586	- 1336	rms: 0.715759	max: 3.17787
change_max is 0.0088528 after 33 calls to inner
Outer: 7	mu: 0.00390625
TOT
 Contraction mapping changes:	+ 1913	- 9	rms: 0.369582	max: 1.34481
change_max is 0.00906801 after 9 calls to inner
Outer: 8	mu: 0.00195312
TOT
 Contraction mapping changes:	+ 930	- 992	rms: 0.369639	max: 1.16095
change_max is 0.00898255 after 5 calls to inner
Outer: 9	mu: 0.00292969
TOT
 Contraction mapping changes:	+ 1598	- 324	rms: 0.169888	max: 0.809234
change_max is 0.0081333 after 12 calls to inner
Outer: 10	mu: 0.00244141
TOT
 Contraction mapping changes:	+ 842	- 1080	rms: 0.0964153	max: 0.331485
change_max is 0.00593203 after 7 calls to inner
Outer: 11	mu: 0.00219727
TOT
 Contraction mapping changes:	+ 557	- 1365	rms: 0.0583768	max: 0.245895
change_max is 0.00756848 after 5 calls to inner
Repeat_loop false as abs(mu_diff) < tol_mu
mu_diff: 0.0573334	tol_mu: 0.1
About to leave TimminsOuter
The first 10 values of deltas are : 
0.03251
-0.217939
0.261494
-0.389984
-0.0162076
-0.066887
-0.318052
0.424194
-0.413441
-0.0401119

## Mapping completed - control returned to R

##
## Second round: values from first call to mapping algorithm 
# used as inputs, but required precision increased by a couple of orders of magnitude

> x$extractests() -> outputs
 # outputs is the object containing outputs from the first run.
 # the vector of deltas is now available from outputs$deltas
 # the mu value is accessibly as outputs$mu

> rm(x)
###################################################################################
# SECOND STAGE 
###################################################################################

> movingcostmatrix <- MakeMovingCostMatrix(proprents,medval)
Destructor called
> 
> 
 # loading the inputs to the second call to the contraction mapping using
 # inputs from the first occasion
> In2 <- list(
+     data = list(
+         stayerprop= 0.4174,
+         counts = list(
+             oldcounts=countsold,
+             newcounts=countsnew      
+         )
+     ),
+     movingcostmatrix = movingcostmatrix,
+     utils = list(
+         deltas = outputs$deltas # input from first estimation
+     ),
+     params = list(
+         tol_delta = 10^-5, # Higher precision needed : 10^-5 rather than 10^-2
+         tol_mu = 10^-3,
+         mu_upper = 1.10 * outputs$mu, # set the upper bounds as mu_guess + 10%
+         mu_lower = 0.90 * outputs$mu, # lower bound is 90% of mu_guess
+         maxit_outer = 100000,
+         maxit_inner = 100000,
+         use_logmu=F
+     ),
+     dbg = list(
+         dbgflag= T,
+         verboseflag=T
+         
+     )
+ )

# Creation of a new C++ object, with the new inputs
> x2 <- new(Contraction, In2)

use_logmu is 0 i.e. False
Lengths of vectors oldcounts and newcounts are 1921 and 1921 respectively. Is this correct?
Constructor completed

# Run the new object:
> x2$run()
TRC
TP
totpop_t1: 2.94141e+06    totpop_t2: 3.21684e+06	dpop: 275429
The total lengths of oldcounts and newcounts are 1922 and 1922
They should be 1922 in the current example. Are they?
mu_diff: 99.9999	tol_mu: 0.001	stayp: 0.4174

TO 1
Outer: 1	mu: 0.00219727
TOT
 Contraction mapping changes:	+ 862	- 1060	rms: 0.352497	max: 2.97596
change_max is 7.66781e-06 after 19 calls to inner
Outer: 2	mu: 0.00230713
TOT
 Contraction mapping changes:	+ 1480	- 442	rms: 0.0267855	max: 0.123093
change_max is 6.20984e-06 after 18 calls to inner
Outer: 3	mu: 0.0022522
TOT
 Contraction mapping changes:	+ 506	- 1416	rms: 0.0132656	max: 0.0591679
change_max is 7.64482e-06 after 15 calls to inner
Outer: 4	mu: 0.00227966
TOT
 Contraction mapping changes:	+ 1444	- 478	rms: 0.00666132	max: 0.0301928
change_max is 8.55149e-06 after 14 calls to inner
Outer: 5	mu: 0.0022934
TOT
 Contraction mapping changes:	+ 1429	- 493	rms: 0.00328846	max: 0.0145321
change_max is 7.86616e-06 after 13 calls to inner
Outer: 6	mu: 0.00228653
TOT
 Contraction mapping changes:	+ 503	- 1419	rms: 0.00164271	max: 0.00722747
change_max is 6.24501e-06 after 12 calls to inner
Outer: 7	mu: 0.0022831
TOT
 Contraction mapping changes:	+ 496	- 1426	rms: 0.000824019	max: 0.00364926
change_max is 8.8896e-06 after 10 calls to inner
Outer: 8	mu: 0.00228481
TOT
 Contraction mapping changes:	+ 1429	- 493	rms: 0.000412053	max: 0.00182701
change_max is 7.54959e-06 after 9 calls to inner
Repeat_loop false as abs(mu_diff) < tol_mu
mu_diff: -3.9222e-05	tol_mu: 0.001
About to leave TimminsOuter
The first 10 values of deltas are : 
0.0337283
-0.232424
0.267301
-0.380509
-0.0334408
-0.075205
-0.327587
0.406485
-0.411952
-0.0465707

# Convergence, even with orders of magnitude higher precision, was much faster
 # (about a minute?)

> x2$extractests() -> outputs2
> rm(x2)
> movingcostmatrix <- MakeMovingCostMatrix(proprents,medval)
Destructor called

###################################################################################
# THIRD STAGE 
###################################################################################

> In3 <- list(
+     data = list(
+         stayerprop= 0.4174,
+         counts = list(
+             oldcounts=countsold,
+             newcounts=countsnew      
+         )
+     ),
+     movingcostmatrix = movingcostmatrix,
+     utils = list(
+         deltas = outputs2$deltas
+     ),
+     params = list(
+         tol_delta = 10^-8,
+         tol_mu = 10^-6,
+         mu_upper = 1.5 * outputs2$mu,
+         mu_lower = 0.5 * outputs2$mu,
+         maxit_outer = 10000,
+         maxit_inner = 100000,
+         use_logmu=F
+     ),
+     dbg = list(
+         dbgflag= T,
+         verboseflag=T
+         
+     )
+ )
> 
> x3 <- new(Contraction, In3)
Con
use_logmu is 0 i.e. False
Called from: eval(substitute(expr), envir, enclos)
Browse[1]> 
Destructor called
Lengths of vectors oldcounts and newcounts are 1921 and 1921 respectively. Is this correct?
Called from: eval(substitute(expr), envir, enclos)
Browse[1]> 
Constructor completed
> x3$run()
TRC
TP
totpop_t1: 2.94141e+06    totpop_t2: 3.21684e+06	dpop: 275429
Called from: eval(substitute(expr), envir, enclos)
Browse[1]> 
The total lengths of oldcounts and newcounts are 1922 and 1922
They should be 1922 in the current example. Are they?
Called from: eval(substitute(expr), envir, enclos)
Browse[1]> 
mu_diff: 0.0999999	tol_mu: 1e-06	stayp: 0.4174
Called from: eval(substitute(expr), envir, enclos)
Browse[1]> 
TO 1
Outer: 1	mu: 0.00228481
TOT
 Contraction mapping changes:	+ 875	- 1047	rms: 0.329391	max: 2.88894
change_max is 6.60194e-09 after 35 calls to inner
Outer: 2	mu: 0.00171361
TOT
 Contraction mapping changes:	+ 420	- 1502	rms: 0.130094	max: 0.941969
change_max is 6.7043e-09 after 13 calls to inner
Outer: 3	mu: 0.00199921
TOT
 Contraction mapping changes:	+ 1809	- 113	rms: 0.0811825	max: 0.502192
change_max is 5.54993e-09 after 21 calls to inner
Outer: 4	mu: 0.00214201
TOT
 Contraction mapping changes:	+ 1625	- 297	rms: 0.0377946	max: 0.208629
change_max is 8.86586e-09 after 25 calls to inner
Outer: 5	mu: 0.00221341
TOT
 Contraction mapping changes:	+ 1515	- 407	rms: 0.01814	max: 0.0907717
change_max is 7.44732e-09 after 27 calls to inner
Outer: 6	mu: 0.00224911
TOT
 Contraction mapping changes:	+ 1478	- 444	rms: 0.00883485	max: 0.0417255
change_max is 8.01085e-09 after 27 calls to inner
Outer: 7	mu: 0.00226696
TOT
 Contraction mapping changes:	+ 1451	- 471	rms: 0.00435229	max: 0.0199223
change_max is 9.5795e-09 after 26 calls to inner
Outer: 8	mu: 0.00227589
TOT
 Contraction mapping changes:	+ 1437	- 485	rms: 0.0021591	max: 0.00972351
change_max is 9.39541e-09 after 25 calls to inner
Outer: 9	mu: 0.00228035
TOT
 Contraction mapping changes:	+ 1429	- 493	rms: 0.0010752	max: 0.00480208
change_max is 8.42772e-09 after 24 calls to inner
Outer: 10	mu: 0.00228258
TOT
 Contraction mapping changes:	+ 1429	- 493	rms: 0.000536503	max: 0.00238609
change_max is 7.25343e-09 after 23 calls to inner
Outer: 11	mu: 0.0022837
TOT
 Contraction mapping changes:	+ 1429	- 493	rms: 0.000267976	max: 0.0011893
change_max is 6.12275e-09 after 22 calls to inner
Outer: 12	mu: 0.00228426
TOT
 Contraction mapping changes:	+ 1429	- 493	rms: 0.000133919	max: 0.000593716
change_max is 8.50078e-09 after 20 calls to inner
Outer: 13	mu: 0.00228453
TOT
 Contraction mapping changes:	+ 1429	- 493	rms: 6.6942e-05	max: 0.000296624
change_max is 7.07821e-09 after 19 calls to inner
Outer: 14	mu: 0.00228467
TOT
 Contraction mapping changes:	+ 1429	- 493	rms: 3.34667e-05	max: 0.000148253
change_max is 9.76109e-09 after 17 calls to inner
Outer: 15	mu: 0.00228474
TOT
 Contraction mapping changes:	+ 1429	- 493	rms: 1.67323e-05	max: 7.41121e-05
change_max is 8.1057e-09 after 16 calls to inner
Outer: 16	mu: 0.00228478
TOT
 Contraction mapping changes:	+ 1429	- 493	rms: 8.36588e-06	max: 3.70524e-05
change_max is 6.72848e-09 after 15 calls to inner
Outer: 17	mu: 0.00228476
TOT
 Contraction mapping changes:	+ 494	- 1428	rms: 4.1829e-06	max: 1.85259e-05
change_max is 9.24628e-09 after 13 calls to inner
Outer: 18	mu: 0.00228475
TOT
 Contraction mapping changes:	+ 493	- 1429	rms: 2.09151e-06	max: 9.26322e-06
change_max is 7.87012e-09 after 12 calls to inner
Outer: 19	mu: 0.00228476
TOT
 Contraction mapping changes:	+ 1429	- 493	rms: 1.04571e-06	max: 4.6316e-06
change_max is 6.65864e-09 after 11 calls to inner
Outer: 20	mu: 0.00228475
TOT
 Contraction mapping changes:	+ 495	- 1427	rms: 5.22842e-07	max: 2.31579e-06
change_max is 9.61358e-09 after 9 calls to inner
Repeat_loop false as abs(mu_diff) < tol_mu
mu_diff: -5.54669e-08	tol_mu: 1e-06
About to leave TimminsOuter
The first 10 values of deltas are : 
0.0337277
-0.232413
0.267297
-0.380515
-0.0334282
-0.0751986
-0.327579
0.406497
-0.411952
-0.0465656
